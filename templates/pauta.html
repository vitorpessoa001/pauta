<!-- pauta.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pauta da Câmara - Sessões Deliberativas</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .header { background: linear-gradient(135deg, #006633 0%, #008040 100%); color: white; padding: 2rem 0; }
    .header .logo { width: 100px; height: auto; margin-right: 1.5rem; }
    .pauta-card { border-left: 4px solid #006633; background: white; margin-bottom: 1rem; transition: box-shadow 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .pauta-card:hover { box-shadow: 0 4px 15px rgba(0,102,51,0.15); transform: translateY(-2px); }
    .proposicao-titulo { font-weight: 600; color: #006633; margin-bottom: 0.5rem; }
    .proposicao-ident { background: #e3f2fd; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.9em; font-weight: 500; color: #006633; }
    .ementa { color: #555; font-size: 0.95em; line-height: 1.5; border-left: 3px solid #e9ecef; padding-left: 1rem; margin-left: 1rem; background: #f8f9fa; border-radius: 4px; padding: 1rem; }
    .data-picker { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem; }
    .btn-primary { background-color: #006633; border-color: #006633; }
    .btn-primary:hover { background-color: #004d26; border-color: #004d26; }
    .empty-state { text-align: center; padding: 3rem; color: #6c757d; }
    .empty-state i { font-size: 4rem; opacity: 0.3; margin-bottom: 1rem; }
    .loading { display: none !important; text-align: center; padding: 2rem; }
    .loading.show { display: block !important; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .id-proposicao { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; font-size: 0.8em; color: #495057; }
    .total-itens { background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-top: 2rem; }
    .status-badge { font-size: 0.9em; padding: 0.5rem 1rem; }

    .relator-tag { background: #d4edda; color: #155724; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.85em; display: inline-flex; align-items: center; gap: .35rem; }
    .relator-avatar { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; display: inline-block; }

    .autor-tag { background: #cce5ff; color: #004085; padding: 0.2rem 0.4rem; border-radius: 8px; font-size: 0.8em; margin: 0.1rem; display: inline-block; }
    .autores-section { margin-top: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 4px; }
    .autores-section h6 { margin-bottom: 0.5rem; color: #495057; font-size: 0.95em; }

    .regime-tag { background: #fff3cd; color: #856404; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.85em; }
    .topico-tag { background: #d1ecf1; color: #0c5460; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.85em; }

    .destaques-section { margin-top: 1.5rem; padding: 1rem; background: linear-gradient(135deg, #fff5f5, #ffebee); border: 2px solid #f8d7da; border-radius: 8px; }
    .destaques-section h5 { color: #721c24; border-bottom: 2px solid #dc3545; padding-bottom: 0.5rem; margin-bottom: 1rem; }
    .destaque-item { background: white; border-left: 4px solid #dc3545; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; box-shadow: 0 2px 4px rgba(220,53,69,0.1); }
    .destaque-numero { background: #f8d7da; color: #721c24; padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold; display: inline-block; font-size: 0.9em; }
    .destaque-meta { color: #6c757d; font-size: 0.85em; margin-top: 0.5rem; }
    .destaque-ementa { background: #f8f9fa; border-left: 3px solid #dc3545; padding: 0.75rem; margin-top: 0.75rem; border-radius: 4px; font-size: 0.9em; line-height: 1.4; }
    .btn-inteiro-teor { background: #dc3545; border-color: #dc3545; color: white; font-size: 0.85em; padding: 0.25rem 0.75rem; }
    .btn-inteiro-teor:hover { background: #c82333; border-color: #bd2130; color: white; }
    .autor-destaque { background: #cce7ff; color: #004085; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8em; margin-right: 0.5rem; margin-top: 0.25rem; display: inline-block; }
  </style>
</head>
<body>
  <div class="header">
    <div class="container d-flex align-items-center">
      <img src="/static/logo_camara.png" alt="Logo da Câmara" class="logo">
      <div>
        <h1 class="display-5 fw-bold">Pauta da Câmara dos Deputados</h1>
        <p class="lead">Sessões Deliberativas do Plenário - Dados Abertos</p>
      </div>
    </div>
  </div>

  <div class="container my-4">
    <!-- Seleção de Data -->
    <div class="data-picker">
      <div class="row align-items-center">
        <div class="col-md-6">
          <label class="form-label fw-bold mb-2 d-block">
            <i class="fas fa-calendar-alt me-2"></i> Selecione a data da sessão:
          </label>
          <input type="date" id="dataInput" class="form-control" value="{{ data }}">
        </div>
        <div class="col-md-6 text-end">
          <button class="btn btn-outline-secondary btn-lg" onclick="buscarHoje()">
            <i class="fas fa-calendar-day me-2"></i> Hoje
          </button>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-3">Carregando itens da pauta...</p>
    </div>

    {% if mensagem %}
    <div class="alert {% if resultado and resultado.encontrou and resultado.tem_sessao %}alert-success{% elif not resultado or not resultado.tem_sessao %}alert-warning{% else %}alert-danger{% endif %} alert-dismissible fade show">
      <i class="fas {% if resultado and resultado.encontrou and resultado.tem_sessao %}fa-check-circle text-success{% elif not resultado or not resultado.tem_sessao %}fa-calendar-times text-warning{% else %}fa-exclamation-triangle text-danger{% endif %} me-2"></i>
      {{ mensagem }}
      {% if situacao %}<span class="badge bg-primary ms-2 status-badge">{{ situacao }}</span>{% endif %}
      {% if atualizacao %}<small class="opacity-75 d-block mt-1">Atualizado em {{ atualizacao }}</small>{% endif %}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    {% if itens_pauta and itens_pauta|length > 0 %}
    <div class="row" id="pauta-container">
      {% for item in itens_pauta %}
      <div class="col-12 mb-4">
        <div class="card pauta-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="flex-grow-1">
                <h5 class="proposicao-titulo mb-0">
                  <i class="fas fa-file-alt text-primary me-2"></i>
                  <span class="proposicao-ident">{{ item.identificacao_completa }}</span>
                </h5>
              </div>
              <div class="id-proposicao ms-2">
                <i class="fas fa-hashtag me-1"></i> {{ item.id_proposicao }}
              </div>
            </div>

            {% if item.ementa %}
            <div class="mb-3">
              <small class="text-muted d-block mb-1">
                <i class="fas fa-align-left me-1"></i> <strong>Ementa:</strong>
              </small>
              <div class="ementa">{{ item.ementa }}</div>
            </div>
            {% endif %}

            <div class="mt-2 mb-3">
              {% if item.topico %}
              <span class="topico-tag me-2">
                <i class="fas fa-bullhorn me-1"></i> {{ item.topico }}
              </span>
              {% endif %}
              {% if item.regime %}
              <span class="regime-tag me-2" title="{{ item.regime }}">
                <i class="fas fa-clock me-1"></i> {{ item.regime[:30] }}{% if item.regime|length > 30 %}...{% endif %}
              </span>
              {% endif %}
              {% if item.nome_relator %}
              <span class="relator-tag">
                {% if item.relator_foto %}
                  <img loading="lazy" src="{{ item.relator_foto }}" alt="Foto do relator" class="relator-avatar">
                {% endif %}
                <i class="fas fa-user-tie"></i> Relator: {{ item.nome_relator }}
              </span>
              {% endif %}
            </div>

            {% if item.autores %}
            <div class="autores-section">
              <h6><i class="fas fa-users me-1"></i><strong>Autores:</strong></h6>
              {% for autor in item.autores[:8] %}
              <span class="autor-tag">{{ autor }}</span>
              {% endfor %}
              {% if item.autores|length > 8 %}
              <span class="autor-tag bg-secondary text-white">+{{ item.autores|length - 8 }} outros</span>
              {% endif %}
            </div>
            {% endif %}

            {% if item.destaques %}
            <div class="destaques-section">
              <h5>
                <i class="fas fa-exclamation-triangle me-2 text-danger"></i>
                <strong>Destaques DTQ ({{ item.destaques|length }}):</strong>
              </h5>
              {% for destaque in item.destaques %}
              <div class="destaque-item">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <span class="destaque-numero">
                    <i class="fas fa-star me-1"></i>
                    {{ destaque.sigla_tipo }} {{ destaque.numero }}
                  </span>
                  {% if destaque.url_inteiro_teor %}
                  <a href="{{ destaque.url_inteiro_teor }}" target="_blank" class="btn btn-inteiro-teor">
                    <i class="fas fa-external-link-alt me-1"></i>Inteiro Teor
                  </a>
                  {% endif %}
                </div>

                <div class="destaque-meta">
                  <strong>Data de Apresentação:</strong> {{ destaque.data_hora or 'N/D' }} |
                  <strong>Autor(es):</strong>
                  {% for autor in destaque.autores[:3] %}
                  <span class="autor-destaque">{{ autor }}</span>
                  {% endfor %}
                  {% if destaque.autores|length > 3 %}
                  <span class="autor-destaque bg-secondary text-white">+{{ destaque.autores|length - 3 }}</span>
                  {% endif %}
                </div>

                {% if destaque.ementa %}
                <div class="destaque-ementa">
                  <strong>Ementa do Destaque:</strong>
                  <div class="mt-2">{{ destaque.ementa }}</div>
                </div>
                {% endif %}

                {% if destaque.descricao_tipo %}
                <div class="mt-2">
                  <small class="text-danger"><strong>Tipo:</strong> {{ destaque.descricao_tipo }}</small>
                </div>
                {% endif %}

                {% if destaque.despacho %}
                <div class="mt-1">
                  <small class="text-muted"><strong>Despacho:</strong> {{ destaque.despacho }}</small>
                </div>
                {% endif %}
              </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="total-itens">
      <i class="fas fa-list me-2"></i>
      <strong>Total: {{ itens_pauta|length }} itens na pauta</strong><br>
      <small class="opacity-75">Com destaques DTQ completos (número, data e hora, autores, ementa, inteiro teor)</small>
    </div>

    {% else %}
    <div class="empty-state">
      <i class="fas fa-calendar-times"></i>
      <h4>Sem pauta disponível</h4>
      <p>Não há itens na pauta para esta data.</p>
    </div>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const dataInput = document.getElementById('dataInput');
    const hoje = new Date().toISOString().split('T')[0];
    const maxData = new Date();
    maxData.setDate(maxData.getDate() + 30);
    dataInput.max = maxData.toISOString().split('T')[0];
    if (!dataInput.value) { dataInput.value = hoje; }
    document.getElementById('loading').classList.add('show');

    function buscarHoje(){ dataInput.value = hoje; buscarPauta(); }
    function buscarPauta(){
      const data = dataInput.value;
      if (!data) { alert('Selecione uma data.'); return; }
      document.getElementById('loading').classList.add('show');
      const pautaContainer = document.getElementById('pauta-container');
      if (pautaContainer) pautaContainer.style.display = 'none';
      setTimeout(() => { window.location.href = `/?data=${data}`; }, 500);
    }
    dataInput.addEventListener('change', buscarPauta);
    document.addEventListener('DOMContentLoaded', function(){
      const loading = document.getElementById('loading');
      const pautaContainer = document.getElementById('pauta-container');
      if (loading) loading.classList.remove('show');
      if (pautaContainer) {
        pautaContainer.style.opacity = '0';
        setTimeout(() => {
          pautaContainer.style.transition = 'opacity 0.5s';
          pautaContainer.style.opacity = '1';
        }, 100);
      }
      dataInput.focus();
    });
  </script>
</body>
</html>
